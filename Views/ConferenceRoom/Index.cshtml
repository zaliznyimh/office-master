@model IEnumerable<OfficeMaster.Models.ConferenceRoom>

@{
    ViewData["Title"] = "Select Room";
}

<div class="container mt-4">
    <form asp-action="Index" method="get" id="filterForm">
        
        <div class="row mb-4">
            <div class="col-12">
                <div class="input-group">
                    <input type="text" name="search" class="form-control p-3 border-0" 
                           placeholder="Search rooms by name or description..." 
                           value="@ViewBag.CurrentSearch"
                           style="background-color: var(--bg-secondary); color: var(--color-text-title); border-radius: 12px 0 0 12px;">
                    <button type="submit" class="btn btn-primary px-4" style="border-radius: 0 12px 12px 0;">
                        Search
                    </button>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-9">
                <div class="row g-4">
                    @if (!Model.Any())
                    {
                        <div class="text-center py-5">
                            <h4 style="color: var(--color-text-body);">No rooms match your filters </h4>
                            <p style="color: var(--color-text-body); opacity: 0.7;">Try change capacity range or removing some filters.</p>
                        </div>
                    }

                    @foreach (var room in Model)
                    {
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 border-0 shadow-sm" 
                                 style="background-color: var(--bg-secondary); border-radius: 16px; overflow: hidden; transition: transform 0.2s;">
                                
                                <div style="height: 180px; background-color: #2a2d45; overflow: hidden; position: relative;">
                                    @if (!string.IsNullOrEmpty(room.ImageUrl))
                                    {
                                        <img src="@room.ImageUrl" alt="@room.Name" style="width: 100%; height: 100%; object-fit: cover;">
                                    }
                                    else
                                    {
                                        // TODO: Implement image for non image rooms
                                    }
                                    
                                    <span class="badge position-absolute top-0 end-0 m-3" 
                                          style="background-color: rgba(0,0,0,0.6); backdrop-filter: blur(4px);">
                                        @room.RoomType
                                    </span>
                                </div>

                                <div class="card-body d-flex flex-column">
                                    <h5 class="fw-bold mb-1" style="color: var(--color-text-title);">@room.Name</h5>
                                    
                                    @if (!string.IsNullOrEmpty(room.Description))
                                    {
                                        <p class="small text-truncate" style="color: var(--color-text-body); opacity: 0.8;">@room.Description</p>
                                    }

                                    <div class="mb-3 small" style="color: var(--color-text-body);">
                                        <span> @room.Capacity ppl</span>
                                        <span class="mx-2">•</span>
                                        <span> @room.PricePerHour $ h</span>
                                    </div>
                                    
                                    <div class="mb-3">
                                        @if (room.HasProjector)
                                        {
                                            <span class="badge me-1 fw-normal" style="background-color: var(--bg-main); color: var(--color-text-body); border: 1px solid var(--color-action-sub);">
                                                Projector
                                            </span>
                                        }
                                    </div>

                                    <a href="#" class="btn btn-primary w-100 mt-auto fw-bold">
                                        Book Now
                                    </a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <div class="col-md-3">
                <div class="p-4 rounded-4 sticky-top" style="background-color: var(--bg-secondary); top: 20px; z-index: 100;">
                    <h5 class="fw-bold mb-4" style="color: var(--color-text-title);">Filters</h5>
                    
                    <div class="mb-4">
                        <label class="form-label mb-2" style="color: var(--color-text-body);">Capacity (people)</label>
                        <div class="d-flex align-items-center gap-2">
                            <input type="number" name="minCapacity" class="form-control text-center" 
                                   placeholder="Min" min="1"
                                   value="@ViewBag.MinCapacity"
                                   style="background-color: var(--bg-main); color: var(--color-text-title); border: 1px solid var(--color-action-sub);">
                            
                            <span style="color: var(--color-text-body); opacity: 0.5;">-</span>
                            
                            <input type="number" name="maxCapacity" class="form-control text-center" 
                                   placeholder="Max" min="1"
                                   value="@ViewBag.MaxCapacity"
                                   style="background-color: var(--bg-main); color: var(--color-text-title); border: 1px solid var(--color-action-sub);">
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label mb-2" style="color: var(--color-text-body);">Room Type</label>
                        <select name="type" class="form-select border-0" 
                                asp-items="Html.GetEnumSelectList<OfficeMaster.Models.Enum.RoomType>()"
                                style="background-color: var(--bg-main); color: var(--color-text-title); border: 1px solid var(--color-action-sub);">
                            <option value="">All Types</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="form-label mb-2" style="color: var(--color-text-body);">Facilities</label>
                        
                        <div class="form-check mb-2">
                            <input class="form-check-input custom-check" type="checkbox" name="hasProjector" value="true" id="tagPro"
                                   @(ViewBag.CurrentProjector == true ? "checked" : "")>
                            <label class="form-check-label" for="tagPro" style="color: var(--color-text-body);">Projector</label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 mb-2 fw-bold">
                        Apply Filters
                    </button>
                    
                    <a asp-action="Index" class="btn w-100" style="border: 1px solid var(--color-action-sub); color: var(--color-text-body);">
                        Reset
                    </a>
                </div>
            </div>
        </div>
    </form>
</div>

<style>
    .custom-check {
        background-color: var(--bg-main);
        border-color: var(--color-action-sub);
        cursor: pointer;
    }
    .custom-check:checked {
        background-color: var(--color-action-primary);
        border-color: var(--color-action-primary);
        box-shadow: none;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.3) !important;
    }
    
    input[type=number]::-webkit-inner-spin-button, 
    input[type=number]::-webkit-outer-spin-button { 
        -webkit-appearance: none; 
        margin: 0; 
    }
</style>